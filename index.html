<!DOCTYPE html>
<html>
<head>
        <title>SBX Tracker</title>
</head>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3mobile.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-blue.css">
<style>
    .floating-box {
    display: inline-block;
    width: 90px;
    height: 75px;
    margin: 10px
        }
    .floating-box-narrow {
    display: inline-block;
    width: 50px;
    height: 75px;
    margin: 10px
        }
</style>




<body>

    <div class="floating-box-narrow"> <img src="logo.png" height="80" > </div>
    <div class="floating-box">Race Codex
                <select onchange="refreshData(name,value)" id="raceCodexDropdown" name="raceCodex" class="w3-input" >
                        <option value="All" >All</option>
                      </select>
                    </div>
    <div class="floating-box">Race Phase
                                <select onchange="refreshData(name,value)" name="phaseID" class="w3-input" >
                    <option value="All">All</option>
                    <option value="Heat1">Heat1</option>
                    <option value="Heat2">Heat2</option>
                    <option value="Heat3">Heat3</option>
                    <option value="Heat4">Heat4</option>
                    <option value="Heat5">Heat5</option>
                    <option value="Heat6">Heat6</option>
                    <option value="Quarter1">Quarter1</option>
                    <option value="Quarter2">Quarter2</option>
                    <option value="Quarter3">Quarter3</option>
                    <option value="Quarter4">Quarter4</option>
                    <option value="Semi1">Semi1</option>
                    <option value="Semi2">Semi2</option>
                    <option value="Final">Final</option>
                    </select>
                    </div>
            
    </div>
    <div>
        <svg width="50" height="30">
            <text x="10" y="20" style="fill:black;">Lane </text>
        </svg>
        <svg width="100" height="30">
            <text x="10" y="20" style="fill:green;">1st at Hole </text>
        </svg>        
        <svg width="100" height="30">
            <text x="10" y="20" style="fill:green;">1st at Split </text>
        </svg>        
        <svg width="100" height="30">
            <text x="10" y="20" style="fill:green;">1st at Finish </text>
        </svg>
    </div>

<div>
 <svg width="50" height="20">
        <text x="10" y="20" style="fill:red;">1: </text>
  </svg>
  <svg width="100" height="20">
        <rect id='Lane1Hole' width="30" height="75" style="fill:rgb(26, 192, 192)"/>
    </svg>
  <svg width="100" height="20">
        <rect id='Lane1Split' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>

  <svg width="100" height="20">
        <rect id='Lane1Finish' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>
</div>

<div>
    <svg width="50" height="20">
        <text x="10" y="20" style="fill:red;">2: </text>
    </svg>

    <svg width="100" height="20">
        <rect id='Lane2Hole' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>

    <svg width="100" height="20">
        <rect id='Lane2Split' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>

    <svg width="100" height="20">
        <rect id='Lane2Finish' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>
</div>

<div>
    <svg width="50" height="20">
        <text x="10" y="20" style="fill:red;">3: </text>
    </svg>

    <svg width="100" height="20">
        <rect id='Lane3Hole' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>

    <svg width="100" height="20">
        <rect id='Lane3Split' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>

    <svg width="100" height="20">
        <rect id='Lane3Finish' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>
</div>


<div>
    <svg width="50" height="20">
        <text x="10" y="20" style="fill:red;">4: </text>
    </svg>

    <svg width="100" height="20">
        <rect id='Lane4Hole' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>

    <svg width="100" height="20">
        <rect id='Lane4Split' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>

    <svg width="100" height="20">
        <rect id='Lane4Finish' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>
</div>

<div>
    <svg width="50" height="20">
        <text x="10" y="20" style="fill:red;">5: </text>
    </svg>

    <svg width="100" height="20">
        <rect id='Lane5Hole' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>

    <svg width="100" height="20">
        <rect id='Lane5Split' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>

    <svg width="100" height="20">
        <rect id='Lane5Finish' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>
</div>


<div>
    <svg width="50" height="20">
        <text x="10" y="20" style="fill:red;">6: </text>
    </svg>

    <svg width="100" height="20">
        <rect id='Lane6Hole' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>

    <svg width="100" height="20">
        <rect id='Lane6Split' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>

    <svg width="100" height="20">
        <rect id='Lane6Finish' width="30" height="75" style="fill:rgb(26, 192, 192)" />
    </svg>
</div>

<br>
<div>
    <a href="mailto:sbxtracker@hotmail.com" style="font-size:50%; color:blue">Feedback</a>



</div>



<script>
refreshRequestRaceCodex = "All";
refreshRequestPhaseID = "All";

function refreshData(name, value) {
    console.log('refreshData called', name, value);

    if (name === 'raceCodex') {refreshRequestRaceCodex = value}
    if (name === 'phaseID') {refreshRequestPhaseID = value}
    refreshRequestURL = "http://sbxdataprovider.azurewebsites.net"
    if (refreshRequestRaceCodex != 'All') {
        refreshRequestURL += "?raceCodex=" + refreshRequestRaceCodex;
        if (refreshRequestPhaseID != 'All') {
            refreshRequestURL += "&phaseID=" + refreshRequestPhaseID
            };
        } else {
            if (refreshRequestPhaseID != 'All') {
                refreshRequestURL += "?phaseID=" + refreshRequestPhaseID
                };
        };
   
    console.log(refreshRequestURL);

    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        console.log(this.responseText);
        latestData = JSON.parse(this.responseText);
        console.log(latestData);
        totalFirstAtHole = latestData.Lane1FirstAtHole + latestData.Lane2FirstAtHole + latestData.Lane3FirstAtHole + latestData.Lane4FirstAtHole + latestData.Lane5FirstAtHole + latestData.Lane6FirstAtHole;
        totalFirstAtSplit = latestData.Lane1FirstAtSplit + latestData.Lane2FirstAtSplit + latestData.Lane3FirstAtSplit + latestData.Lane4FirstAtSplit + latestData.Lane5FirstAtSplit + latestData.Lane6FirstAtSplit;
        totalFirstAtFinish = latestData.Lane1FirstAtFinish + latestData.Lane2FirstAtFinish + latestData.Lane3FirstAtFinish + latestData.Lane4FirstAtFinish + latestData.Lane5FirstAtFinish + latestData.Lane6FirstAtFinish;
        
        if (totalFirstAtHole != 0 ) {
            document.getElementById('Lane1Hole').width.baseVal.value = latestData.Lane1FirstAtHole / totalFirstAtHole * 100;
            document.getElementById('Lane2Hole').width.baseVal.value = latestData.Lane2FirstAtHole / totalFirstAtHole * 100;
            document.getElementById('Lane3Hole').width.baseVal.value = latestData.Lane3FirstAtHole / totalFirstAtHole * 100;
            document.getElementById('Lane4Hole').width.baseVal.value = latestData.Lane4FirstAtHole / totalFirstAtHole * 100;
            document.getElementById('Lane5Hole').width.baseVal.value = latestData.Lane5FirstAtHole / totalFirstAtHole * 100;
            document.getElementById('Lane6Hole').width.baseVal.value = latestData.Lane6FirstAtHole / totalFirstAtHole * 100;
        } else {
            document.getElementById('Lane1Hole').width.baseVal.value = 0;
            document.getElementById('Lane2Hole').width.baseVal.value = 0;
            document.getElementById('Lane3Hole').width.baseVal.value = 0;
            document.getElementById('Lane4Hole').width.baseVal.value = 0;
            document.getElementById('Lane5Hole').width.baseVal.value = 0;
            document.getElementById('Lane6Hole').width.baseVal.value = 0;
        };

        if (totalFirstAtSplit != 0 ) { 
            document.getElementById('Lane1Split').width.baseVal.value = latestData.Lane1FirstAtSplit / totalFirstAtSplit * 100;
            document.getElementById('Lane2Split').width.baseVal.value = latestData.Lane2FirstAtSplit / totalFirstAtSplit * 100;
            document.getElementById('Lane3Split').width.baseVal.value = latestData.Lane3FirstAtSplit / totalFirstAtSplit * 100;
            document.getElementById('Lane4Split').width.baseVal.value = latestData.Lane4FirstAtSplit / totalFirstAtSplit * 100;
            document.getElementById('Lane5Split').width.baseVal.value = latestData.Lane5FirstAtSplit / totalFirstAtSplit * 100;
            document.getElementById('Lane6Split').width.baseVal.value = latestData.Lane6FirstAtSplit / totalFirstAtSplit * 100;
        } else {
            document.getElementById('Lane1Split').width.baseVal.value = 0;
            document.getElementById('Lane2Split').width.baseVal.value = 0;
            document.getElementById('Lane3Split').width.baseVal.value = 0;
            document.getElementById('Lane4Split').width.baseVal.value = 0;
            document.getElementById('Lane5Split').width.baseVal.value = 0;
            document.getElementById('Lane6Split').width.baseVal.value = 0;
        };

        if (totalFirstAtFinish !=0 ) {
            document.getElementById('Lane1Finish').width.baseVal.value = latestData.Lane1FirstAtFinish / totalFirstAtFinish * 100;
            document.getElementById('Lane2Finish').width.baseVal.value = latestData.Lane2FirstAtFinish / totalFirstAtFinish * 100;
            document.getElementById('Lane3Finish').width.baseVal.value = latestData.Lane3FirstAtFinish / totalFirstAtFinish * 100;
            document.getElementById('Lane4Finish').width.baseVal.value = latestData.Lane4FirstAtFinish / totalFirstAtFinish * 100;
            document.getElementById('Lane5Finish').width.baseVal.value = latestData.Lane5FirstAtFinish / totalFirstAtFinish * 100;
            document.getElementById('Lane6Finish').width.baseVal.value = latestData.Lane6FirstAtFinish / totalFirstAtFinish * 100;
        } else {
            document.getElementById('Lane1Finish').width.baseVal.value = 0;
            document.getElementById('Lane2Finish').width.baseVal.value = 0;
            document.getElementById('Lane3Finish').width.baseVal.value = 0;
            document.getElementById('Lane4Finish').width.baseVal.value = 0;
            document.getElementById('Lane5Finish').width.baseVal.value = 0;
            document.getElementById('Lane6Finish').width.baseVal.value = 0;
        };
      } else {
          console.log(this.status);
      }
    };

    xhttp.open("GET", refreshRequestURL, true);
    // xhttp.setRequestHeader('Access-Control-Allow-Origin', "https://sbxdashboard.azurewebsites.net")
    xhttp.send();
};

function loadRaceCodexData() {
    console.log('loadRaceCodexData called');
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        console.log(this.responseText);
        latestData = JSON.parse(this.responseText);
        console.log(latestData)
        latestData.forEach(function(item){
            newOption = document.createElement('option');
            newOption.value =  item.raceCodex;
            newOption.text =  item.raceCodex;
            document.getElementById('raceCodexDropdown').appendChild(newOption);   
        });

      } else {
        console.log (this.status);
        }
    };

    xhttp.open("GET", "http://sbxdataprovider.azurewebsites.net/getCodex", true);
    xhttp.send();
};

loadRaceCodexData();
</script>


</body>
</html>